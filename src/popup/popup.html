<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BuzzChat</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <!-- Skip Link for Accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>

  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1>BuzzChat</h1>
        <!-- Platform Detection Badge -->
        <div class="platform-badge" id="platformBadge" title="Detected streaming platform">
          <span class="platform-icon" id="platformIcon"></span>
          <span class="platform-name" id="platformName">Detecting...</span>
        </div>
        <!-- Account Selector (Max tier only) -->
        <div class="account-selector" id="accountSelectorContainer" style="display: none;">
          <select id="accountSelect" aria-label="Select configuration">
            <!-- Populated dynamically -->
          </select>
          <button id="newAccountBtn" class="icon-btn" title="Add a new configuration setup" aria-label="Add new configuration">+</button>
          <button id="manageAccountsBtn" class="icon-btn" title="Manage your configuration setups" aria-label="Manage configurations">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
          </button>
        </div>
      </div>
      <div class="header-right">
        <div class="save-indicator" id="saveIndicator" aria-live="polite">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
          </svg>
          Saved
        </div>
        <button id="helpBtn" class="help-btn" title="Help & Support" aria-label="Help and Support">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </button>
        <div class="status-badge" id="statusBadge" title="Shows if bot is currently active on this tab">
          <span class="status-dot"></span>
          <span class="status-text">Inactive</span>
        </div>
      </div>
    </header>

    <!-- Tier Info -->
    <div class="tier-banner" id="tierBanner">
      <div class="vip-badge" id="vipBadge" style="display: none;">
        <svg class="vip-icon" viewBox="0 0 24 24" width="14" height="14" fill="currentColor" role="img" aria-label="VIP status">
          <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <span class="vip-tier-text">PRO</span>
      </div>
      <span class="tier-label">Free Plan</span>
      <!-- Compact AI credits badge (Max tier only) -->
      <span class="ai-credits-badge" id="aiCreditsBadge" style="display: none;" title="AI credits remaining this month">
        <span class="ai-credits-icon" aria-hidden="true">ü§ñ</span>
        <span class="ai-credits-count" id="aiCreditsCount">500</span>
      </span>
      <span class="tier-usage">Unlimited messages</span>
      <span class="member-since" id="memberSince" style="display: none;"></span>
      <button class="upgrade-btn" id="upgradeBtn" title="Unlock unlimited messages and Pro features">Upgrade to Pro</button>
    </div>

    <!-- AI Credits Section (Max tier only) -->
    <div id="aiCreditsSection" class="credits-section" style="display: none;">
      <div class="credits-header">
        <span class="credits-icon">&#x1F916;</span>
        <span class="credits-title">AI Credits</span>
      </div>
      <div class="credits-bar">
        <div class="credits-fill" id="creditsFill" style="width: 100%"></div>
      </div>
      <div class="credits-info">
        <span id="creditsRemaining">500</span> / 500 remaining
      </div>
      <div class="credits-reset">
        Resets <span id="creditsResetDate">next month</span>
      </div>
    </div>

    <!-- Master Toggle -->
    <div class="master-toggle">
      <label class="toggle-label">
        <span>Bot Active</span>
        <input type="checkbox" id="masterToggle" aria-label="Enable chat bot" role="switch">
        <span class="toggle-slider"></span>
      </label>
    </div>

    <!-- Tabs -->
    <nav class="tabs" role="tablist" aria-label="Main navigation">
      <button id="home-tab" class="tab-btn active" data-tab="home" role="tab" aria-selected="true" aria-controls="home-panel" title="Welcome message settings">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        <span>Home</span>
      </button>
      <button id="messages-tab" class="tab-btn" data-tab="messages" role="tab" aria-selected="false" aria-controls="messages-panel" title="Timer messages & quick templates">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
        <span>Messages</span>
      </button>
      <button id="faq-tab" class="tab-btn" data-tab="faq" role="tab" aria-selected="false" aria-controls="faq-panel" title="Auto-reply to common questions">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span>FAQ</span>
      </button>
      <button id="commands-tab" class="tab-btn" data-tab="commands" role="tab" aria-selected="false" aria-controls="commands-panel" title="Create !commands for chat">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <span>Commands</span>
      </button>
      <button id="moderation-tab" class="tab-btn" data-tab="moderation" role="tab" aria-selected="false" aria-controls="moderation-panel" title="Block words & spam protection">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg>
        <span>Moderation</span>
      </button>
      <button id="giveaway-tab" class="tab-btn" data-tab="giveaway" role="tab" aria-selected="false" aria-controls="giveaway-panel" title="Track entries & pick winners">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" />
        </svg>
        <span>Giveaway</span>
      </button>
      <button id="inventory-tab" class="tab-btn" data-tab="inventory" role="tab" aria-selected="false" aria-controls="inventory-panel" title="Track products & sales">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
        </svg>
        <span>üì¶ Inventory</span>
      </button>
      <button id="analytics-tab" class="tab-btn" data-tab="analytics" role="tab" aria-selected="false" aria-controls="analytics-panel" title="View message statistics (Pro)">
        <svg class="tab-icon" viewBox="0 0 24 24" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg>
        <span>Analytics</span>
      </button>
    </nav>

    <!-- Tab Content -->
    <div class="tab-content" id="main-content">
      <!-- Home Tab (Welcome settings) -->
      <section class="tab-panel active" id="home-panel" role="tabpanel" aria-labelledby="home-tab">
        <!-- Live Seller Dashboard -->
        <details class="dashboard-section" id="dashboardSection" open>
          <summary>
            <span class="section-title-icon">üìä</span>
            Live Dashboard
            <span class="dashboard-alert-badge" id="dashboardAlertBadge" style="display: none;">0</span>
          </summary>
          <div class="dashboard-content">
            <!-- Stream Controls -->
            <div class="dashboard-controls">
              <button class="btn btn-primary btn-sm" id="dashboardStartBtn" title="Start tracking this stream">
                ‚ñ∂Ô∏è Start Stream
              </button>
              <button class="btn btn-secondary btn-sm" id="dashboardEndBtn" title="End stream session">
                ‚èπÔ∏è End Stream
              </button>
              <span class="dashboard-uptime" id="dashboardUptime">--</span>
            </div>

            <!-- Real-time Stats Grid -->
            <div class="dashboard-stats-grid">
              <div class="dashboard-stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-value" id="dashboardViewers">0</div>
                <div class="stat-label">Viewers</div>
              </div>
              <div class="dashboard-stat-card">
                <div class="stat-icon">üí¨</div>
                <div class="stat-value" id="dashboardChatRate">0</div>
                <div class="stat-label">Chat/min</div>
              </div>
              <div class="dashboard-stat-card">
                <div class="stat-value engagement-indicator engagement-low" id="dashboardEngagement" title="Engagement level">üìä</div>
                <div class="stat-label">Engagement</div>
              </div>
              <div class="dashboard-stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value" id="dashboardRevenue">$0.00</div>
                <div class="stat-label">Est. Revenue</div>
              </div>
            </div>

            <!-- Hot Items Section -->
            <div class="dashboard-hot-items-section">
              <h4 class="dashboard-section-title">üî• Hot Items</h4>
              <div class="dashboard-hot-items" id="dashboardHotItems">
                <div class="empty-state-inline">
                  <span class="empty-icon">üî•</span>
                  <p class="empty-entries">No trending items yet</p>
                </div>
              </div>
            </div>

            <!-- Alerts Section -->
            <div class="dashboard-alerts-section">
              <h4 class="dashboard-section-title">üîî Alerts</h4>
              <div class="dashboard-alerts" id="dashboardAlerts">
                <div class="empty-state-inline">
                  <span class="empty-icon">üîî</span>
                  <p class="empty-entries">No alerts</p>
                </div>
              </div>
            </div>
          </div>
        </details>

        <hr class="section-divider">

        <div class="feature-toggle">
          <label class="toggle-label">
            <span>Auto-Welcome New Viewers</span>
            <input type="checkbox" id="welcomeToggle" aria-label="Enable welcome messages" role="switch">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="form-group">
          <label for="welcomeMessage">Welcome Message</label>
          <textarea id="welcomeMessage" rows="3" placeholder="Hey {username}! Welcome to the stream! Drop a comment to enter our giveaway!" aria-describedby="welcomeMessage-help"></textarea>
          <small id="welcomeMessage-help" class="help-text">Variables: {username}, {time}, {date}, {uptime}, {platform}, {viewers}</small>
        </div>

        <div class="form-group">
          <label for="welcomeDelay">Delay Between Welcomes (seconds)</label>
          <input type="number" id="welcomeDelay" value="5" min="1" max="60" aria-describedby="welcomeDelay-help">
          <small id="welcomeDelay-help" class="help-text">Avoid spam by spacing out welcome messages</small>
        </div>

        <!-- Buyer Profiles Section -->
        <details class="buyer-section" id="buyerSection">
          <summary>
            <span class="section-title-icon">üë•</span>
            Buyer Profiles
            <span class="buyer-stats-badge">
              <span id="buyerVipCount">0</span> VIP ¬∑ <span id="buyerTotalCount">0</span> total
            </span>
          </summary>
          <div class="buyer-section-content">
            <p class="help-text">Track your repeat buyers and VIP customers for personalized welcomes.</p>
            
            <!-- Buyer List -->
            <div class="buyer-panel" id="buyerPanel">
              <div class="buyer-list" id="buyerList">
                <div class="empty-state-inline">
                  <span class="empty-icon">üë•</span>
                  <p class="empty-entries">No buyers tracked yet</p>
                  <p class="empty-hint">Buyer profiles are created when you record purchases.</p>
                </div>
              </div>
            </div>

            <!-- Buyer Actions -->
            <div class="buyer-actions">
              <button class="btn btn-secondary btn-sm" id="refreshBuyersBtn" title="Refresh buyer list">
                Refresh
              </button>
              <button class="btn btn-secondary btn-sm" id="exportBuyersBtn" title="Export buyers as CSV">
                Export CSV
              </button>
              <button class="btn btn-secondary btn-sm" id="searchBuyersBtn" title="Search buyers">
                Search
              </button>
            </div>
          </div>
        </details>
      </section>

      <!-- Messages Tab (Timer + Templates combined) -->
      <section class="tab-panel" id="messages-panel" role="tabpanel" aria-labelledby="messages-tab">
        <!-- Timer Section -->
        <div class="messages-section">
          <div class="feature-toggle">
            <label class="toggle-label">
              <span>Timer Messages</span>
              <input type="checkbox" id="timerToggle" aria-label="Enable timer messages" role="switch">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="timer-messages" id="timerMessages">
            <!-- Timer messages will be added here -->
          </div>

          <button class="btn btn-primary add-timer-btn" id="addTimerBtn" title="Create a recurring message that sends automatically">
            + Add Timer Message
          </button>
        </div>

        <!-- Divider -->
        <hr class="section-divider">

        <!-- Templates Section -->
        <div class="messages-section">
          <h3 class="section-title">Quick Templates</h3>
          <div class="templates-list" id="templatesList">
            <!-- Templates will be added here -->
          </div>

          <button class="btn btn-primary add-template-btn" id="addTemplateBtn" title="Add a one-click quick reply template">
            + Add Template
          </button>
        </div>

        <!-- Timer Message Template (hidden) -->
        <template id="timerMessageTemplate">
          <div class="timer-message-item">
            <div class="form-group">
              <label>Message</label>
              <textarea class="timer-text" rows="2" placeholder="Stream has been live for {uptime}! Thanks for watching!"></textarea>
              <small class="help-text">Variables: {time}, {date}, {uptime}, {platform}, {viewers}</small>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Interval (minutes)</label>
                <input type="number" class="timer-interval" value="5" min="1" max="60">
              </div>
              <button class="btn btn-danger btn-sm remove-timer-btn" aria-label="Remove timer message">Remove</button>
            </div>
          </div>
        </template>

        <!-- Template Template (hidden) -->
        <template id="templateTemplate">
          <div class="template-item">
            <div class="form-group">
              <label>Template Name</label>
              <input type="text" class="template-name" placeholder="Shipping Info">
            </div>
            <div class="form-group">
              <label>Message</label>
              <textarea class="template-text" rows="2" placeholder="We ship worldwide! Free shipping on orders over $50!"></textarea>
            </div>
            <div class="form-row">
              <button class="btn btn-primary btn-sm send-template-btn">Send Now</button>
              <button class="btn btn-danger btn-sm remove-template-btn" aria-label="Remove template">Remove</button>
            </div>
          </div>
        </template>
      </section>

      <!-- FAQ Tab -->
      <section class="tab-panel" id="faq-panel" role="tabpanel" aria-labelledby="faq-tab">
        <div class="feature-toggle">
          <label class="toggle-label">
            <span>Auto-Reply to FAQs</span>
            <input type="checkbox" id="faqToggle" aria-label="Enable FAQ auto-replies" role="switch">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="faq-items" id="faqItems">
          <!-- FAQ items will be added here -->
        </div>

        <button class="btn btn-primary add-faq-btn" id="addFaqBtn" title="Create an auto-reply rule when keywords are detected">
          + Add FAQ Rule
        </button>

        <!-- FAQ Template (hidden) -->
        <template id="faqTemplate">
          <div class="faq-item">
            <div class="form-group">
              <label>Trigger Keywords (comma-separated)</label>
              <input type="text" class="faq-triggers" placeholder="shipping, ship, deliver">
            </div>
            <div class="form-group">
              <label>Auto-Reply</label>
              <textarea class="faq-reply" rows="2" placeholder="Thanks for asking, {username}! We ship worldwide!"></textarea>
              <small class="help-text">Variables: {username}, {count}, {time}, {date}, {platform}</small>
            </div>
            <!-- AI Toggle (Max tier only) -->
            <div class="form-group faq-ai-toggle-group" style="display: none;">
              <label class="toggle-label ai-toggle">
                <span class="ai-toggle-label">
                  <span class="ai-icon">&#x1F916;</span>
                  AI-Powered Response
                </span>
                <input type="checkbox" class="faq-use-ai" aria-label="Enable AI-powered response" role="switch">
                <span class="toggle-slider"></span>
              </label>
              <small class="help-text ai-help">Uses AI to generate natural responses based on your reply template</small>
            </div>
            <div class="form-row">
              <div class="form-group checkbox-group">
                <label>
                  <input type="checkbox" class="faq-case-sensitive">
                  Case sensitive
                </label>
              </div>
              <button class="btn btn-danger btn-sm remove-faq-btn" aria-label="Remove FAQ rule">Remove</button>
            </div>
          </div>
        </template>
      </section>

      <!-- Commands Tab -->
      <section class="tab-panel" id="commands-panel" role="tabpanel" aria-labelledby="commands-tab">
        <div class="feature-toggle">
          <label class="toggle-label">
            <span>Enable Custom Commands</span>
            <input type="checkbox" id="commandsToggle" aria-label="Enable custom commands" role="switch">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="commands-info">
          <small class="help-text">Create commands like <code>!shipping</code> that auto-reply when viewers type them in chat.</small>
        </div>

        <div class="commands-list" id="commandsList">
          <!-- Commands will be added here -->
        </div>

        <button class="btn btn-primary add-command-btn" id="addCommandBtn" title="Create a !command trigger for chat">
          + Add Command
        </button>

        <hr class="section-divider">

        <div class="commands-actions">
          <button class="btn btn-secondary btn-sm" id="exportCommandsBtn" title="Download commands as JSON file">Export</button>
          <button class="btn btn-secondary btn-sm" id="importCommandsBtn" title="Import commands from JSON file">Import</button>
          <input type="file" id="importCommandsFile" accept=".json" style="display: none;">
        </div>

        <!-- Command Template (hidden) -->
        <template id="commandTemplate">
          <div class="command-item">
            <div class="command-header">
              <div class="command-trigger-display">
                <span class="command-prefix">!</span>
                <input type="text" class="command-trigger" placeholder="shipping" maxlength="20">
              </div>
              <div class="command-stats">
                <span class="command-usage-count" title="Times used">0 uses</span>
              </div>
            </div>
            <div class="form-group">
              <label>Response</label>
              <textarea class="command-response" rows="2" placeholder="Thanks {username}! Used {count} times. We ship within 2-3 business days!" maxlength="500"></textarea>
              <small class="help-text">Variables: {username}, {count}, {time}, {date}, {platform}</small>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label>Cooldown (seconds)</label>
                <input type="number" class="command-cooldown" value="30" min="0" max="300" title="Seconds before this command can be used again">
              </div>
              <button class="btn btn-danger btn-sm remove-command-btn" aria-label="Remove command" title="Delete this command">Remove</button>
            </div>
          </div>
        </template>
      </section>

      <!-- Moderation Tab -->
      <section class="tab-panel" id="moderation-panel" role="tabpanel" aria-labelledby="moderation-tab">
        <div class="feature-toggle">
          <label class="toggle-label">
            <span>Enable Moderation</span>
            <input type="checkbox" id="moderationToggle" aria-label="Enable moderation" role="switch">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="form-group">
          <label for="blockedWords">Blocked Words (comma-separated)</label>
          <textarea id="blockedWords" rows="3" placeholder="spam, scam, fake"></textarea>
          <small class="help-text">Messages containing these words will be ignored by the bot</small>
        </div>

        <div class="feature-toggle">
          <label class="toggle-label">
            <span>Block Repeated Messages</span>
            <input type="checkbox" id="blockRepeatedToggle" aria-label="Block repeated messages" role="switch">
            <span class="toggle-slider"></span>
          </label>
        </div>

        <div class="form-group">
          <label for="maxRepeatCount">Max Repeats Before Block</label>
          <input type="number" id="maxRepeatCount" value="3" min="2" max="10">
          <small class="help-text">How many times a user can send the same message within a minute</small>
        </div>
      </section>

      <!-- Giveaway Tab -->
      <section class="tab-panel" id="giveaway-panel" role="tabpanel" aria-labelledby="giveaway-tab">
        <!-- Entry Management Group -->
        <div class="giveaway-group giveaway-group-primary">
          <div class="giveaway-group-header">Entry Management</div>
          <div class="feature-toggle">
            <label class="toggle-label">
              <span>Track Giveaway Entries</span>
              <input type="checkbox" id="giveawayToggle" aria-label="Enable giveaway tracking" role="switch">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="form-group">
            <label for="giveawayKeywords">Entry Keywords (comma-separated)</label>
            <input type="text" id="giveawayKeywords" value="entered, entry, enter" placeholder="entered, entry, enter">
            <small class="help-text">Keywords that count as giveaway entries</small>
          </div>

          <div class="feature-toggle">
            <label class="toggle-label">
              <span>Unique Entries Only</span>
              <input type="checkbox" id="giveawayUniqueToggle" checked aria-label="Count unique entries only" role="switch">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <!-- Live Entry Counter -->
          <div class="giveaway-stats" aria-live="polite" aria-atomic="true">
            <div class="stat-card giveaway-counter">
              <div class="stat-value" id="giveawayEntryCount" aria-label="Number of giveaway entries">0</div>
              <div class="stat-label">Entries</div>
            </div>
          </div>
        </div>

        <!-- Recent Entries Group -->
        <div class="giveaway-group">
          <div class="giveaway-group-header">Recent Entries</div>
          <div class="giveaway-entries-list" id="giveawayEntriesList">
            <div class="empty-state-inline">
              <span class="empty-icon">üé´</span>
              <p class="empty-entries">No entries yet!</p>
              <p class="empty-hint">When viewers type your keyword in chat, they'll appear here automatically.</p>
            </div>
          </div>
          <div class="giveaway-actions" style="margin-top: var(--space-md);">
            <button class="btn btn-secondary btn-sm" id="refreshGiveawayBtn">Refresh</button>
            <button class="btn btn-danger btn-sm" id="resetGiveawayBtn">Reset Entries</button>
          </div>
        </div>

        <!-- Winner Selection Group -->
        <div class="giveaway-group">
          <div class="giveaway-group-header">Pick a Winner</div>
          <div class="winner-selection">
            <div class="winner-options">
              <div class="form-group" style="margin-bottom: var(--space-sm);">
                <label for="winnerCount">Number of Winners</label>
                <select id="winnerCount">
                  <option value="1">1 Winner</option>
                  <option value="2">2 Winners</option>
                  <option value="3">3 Winners</option>
                  <option value="5">5 Winners</option>
                  <option value="10">10 Winners</option>
                </select>
              </div>
            </div>
            <button class="btn btn-primary spin-wheel-btn" id="spinWheelBtn">
              <svg class="wheel-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M12 6v6l4 2"></path>
              </svg>
              Spin the Wheel!
            </button>
          </div>

          <!-- Winner Display -->
          <div class="winner-display" id="winnerDisplay" style="display: none;">
            <div class="winner-card">
              <div class="winner-emoji">üéâ</div>
              <h3 class="winner-title">Winner!</h3>
              <div class="winner-names" id="winnerNames"></div>
              <div class="winner-actions">
                <button class="btn btn-secondary" id="announceWinnerBtn">Announce in Chat</button>
                <button class="btn btn-secondary" id="rerollWinnerBtn">Re-roll</button>
                <button class="btn btn-secondary" id="closeWinnerBtn">Close</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Analytics Group (Collapsible) -->
        <details class="giveaway-analytics">
          <summary>Live Analytics</summary>
          <div class="giveaway-analytics-content">
            <!-- Live Chat Metrics -->
            <h4 style="margin-bottom: var(--space-sm);">Chat Metrics</h4>
            <div class="chat-metrics-grid">
              <div class="stat-card">
                <div class="stat-value" id="metricMessagesPerMin">0</div>
                <div class="stat-label">Msgs/Min</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="metricUniqueChatters">0</div>
                <div class="stat-label">Chatters</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="metricPeakMsgs">0</div>
                <div class="stat-label">Peak</div>
              </div>
            </div>
            <div class="metrics-actions" style="margin-bottom: var(--space-lg);">
              <button class="btn btn-secondary btn-sm" id="refreshMetricsBtn">Refresh Metrics</button>
            </div>

            <!-- Viewer Leaderboard -->
            <h4 style="margin-bottom: var(--space-sm);">Top Chatters</h4>
            <p class="help-text" style="margin-bottom: var(--space-sm);">Most active viewers this session</p>
            <div class="viewer-leaderboard" id="viewerLeaderboard">
              <div class="empty-state-inline">
                <span class="empty-icon">üë•</span>
                <p class="empty-entries">No viewers tracked yet</p>
                <p class="empty-hint">Viewer activity will appear here as chat messages come in.</p>
              </div>
            </div>
            <div class="viewer-actions" style="margin-bottom: var(--space-lg);">
              <button class="btn btn-secondary btn-sm" id="refreshViewersBtn">Refresh</button>
              <button class="btn btn-secondary btn-sm" id="resetViewersBtn">Reset</button>
            </div>

            <!-- Recent Bids -->
            <h4 style="margin-bottom: var(--space-sm);">Recent Bids</h4>
            <p class="help-text" style="margin-bottom: var(--space-sm);">Detected bid amounts from chat</p>
            <div class="recent-bids-list" id="recentBidsList">
              <div class="empty-state-inline">
                <span class="empty-icon">üí∞</span>
                <p class="empty-entries">No bids detected</p>
                <p class="empty-hint">Enable Bid Alerts in Settings to track bids.</p>
              </div>
            </div>
            <div class="bid-actions">
              <button class="btn btn-secondary btn-sm" id="refreshBidsBtn">Refresh</button>
              <button class="btn btn-secondary btn-sm" id="resetBidsBtn">Reset</button>
            </div>
          </div>
        </details>
      </section>

      <!-- Inventory Tab -->
      <section class="tab-panel" id="inventory-panel" role="tabpanel" aria-labelledby="inventory-tab">
        <!-- Quick Add -->
        <div class="inventory-quick-add">
          <div class="form-group">
            <label for="inventoryQuickAdd">Quick Add Product</label>
            <div class="quick-add-row">
              <input type="text" id="inventoryQuickAdd" placeholder="Jordan 4, $180, 3" aria-describedby="inventoryQuickAdd-help">
              <button class="btn btn-primary" id="inventoryQuickAddBtn">+ Add</button>
            </div>
            <small id="inventoryQuickAdd-help" class="help-text">Format: Product name, $price, quantity</small>
          </div>
        </div>

        <!-- Stream Summary -->
        <div class="inventory-stream-summary">
          <span class="summary-icon">üìä</span>
          <span id="inventoryStreamSummary">This stream: 0 sold ‚Ä¢ $0.00 estimated</span>
        </div>

        <!-- Product List -->
        <div class="inventory-list" id="inventoryList">
          <div class="empty-state-inline">
            <span class="empty-icon">üì¶</span>
            <p class="empty-entries">No products yet!</p>
            <p class="empty-hint">Quick add: "Jordan 4, $180, 3"</p>
          </div>
        </div>

        <!-- Actions -->
        <div class="inventory-actions-bar">
          <button class="btn btn-secondary btn-sm" id="inventoryExportBtn">Export CSV</button>
          <button class="btn btn-secondary btn-sm" id="inventoryResetSessionBtn">Reset Session</button>
        </div>

        <!-- Sold Detection Settings -->
        <details class="inventory-settings">
          <summary>SOLD Detection Settings</summary>
          <div class="settings-section-content">
            <div class="feature-toggle">
              <label class="toggle-label">
                <span>Auto-detect Purchase Intent</span>
                <input type="checkbox" id="inventoryAutoDetectToggle" checked aria-label="Enable SOLD detection" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <small class="help-text">Detects "sold", "I'll take it", "mine", "claiming" in chat and prompts you to mark items sold.</small>
          </div>
        </details>
      </section>

      <!-- Analytics Tab (Pro Feature) -->
      <section class="tab-panel" id="analytics-panel" role="tabpanel" aria-labelledby="analytics-tab">
        <div class="analytics-container" id="analyticsContainer">
          <!-- Pro tier check will show content or upgrade prompt -->
        </div>

        <div class="analytics-locked" id="analyticsLocked">
          <div class="locked-content">
            <div class="locked-icon">üìä</div>
            <h3>Analytics Dashboard</h3>
            <p>See what's working in your shows</p>
            <ul class="locked-features">
              <li>7/30 day message trends</li>
              <li>Peak activity hours</li>
              <li>Top FAQ triggers</li>
              <li>Message type breakdown</li>
              <li>Export to CSV</li>
            </ul>
            <button class="btn btn-primary" id="unlockAnalyticsBtn">Upgrade to Pro - $4.99/mo</button>
          </div>
        </div>

        <div class="analytics-content" id="analyticsContent" style="display: none;">
          <!-- Impact Summary - emotionally rewarding stats for VIPs -->
          <div class="impact-summary" id="impactSummary">
            <div class="impact-header">
              <h3>Your Impact This Month</h3>
              <span class="impact-growth" id="impactGrowth" style="display: none;"></span>
            </div>
            <div class="impact-stats">
              <div class="impact-stat highlight">
                <div class="impact-value" id="impactViewers">0</div>
                <div class="impact-label">Viewers Welcomed</div>
              </div>
              <div class="impact-stat">
                <div class="impact-value" id="impactTimeSaved">0</div>
                <div class="impact-label" id="impactTimeLabel">Minutes Saved</div>
              </div>
              <div class="impact-stat">
                <div class="impact-value" id="impactQuestions">0</div>
                <div class="impact-label">Questions Answered</div>
              </div>
            </div>
          </div>

          <div class="analytics-stats">
            <div class="stat-card">
              <div class="stat-info">
                <div class="stat-label">Total Messages</div>
                <div class="stat-helper">Sent by BuzzChat for you</div>
              </div>
              <div class="stat-value" id="statTotalMessages">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-info">
                <div class="stat-label">Today</div>
                <div class="stat-helper">Messages this session</div>
              </div>
              <div class="stat-value" id="statTodayMessages">0</div>
            </div>
            <div class="stat-card">
              <div class="stat-info">
                <div class="stat-label">Peak Hour</div>
                <div class="stat-helper">When you're busiest</div>
              </div>
              <div class="stat-value" id="statPeakHour">--</div>
            </div>
          </div>

          <div class="analytics-section">
            <h4>Last 7 Days</h4>
            <div class="chart-container" id="weeklyChart"></div>
          </div>

          <div class="analytics-section">
            <h4>Message Breakdown</h4>
            <p class="section-helper">How BuzzChat helped you this week</p>
            <div class="message-types-grid">
              <div class="message-type-card welcome">
                <span class="type-icon">üëã</span>
                <span class="type-count" id="legendWelcome">0</span>
                <span class="type-label">Welcomes</span>
              </div>
              <div class="message-type-card faq">
                <span class="type-icon">‚ùì</span>
                <span class="type-count" id="legendFaq">0</span>
                <span class="type-label">FAQ Replies</span>
              </div>
              <div class="message-type-card timer">
                <span class="type-icon">‚è∞</span>
                <span class="type-count" id="legendTimer">0</span>
                <span class="type-label">Timer Messages</span>
              </div>
              <div class="message-type-card template">
                <span class="type-icon">üìù</span>
                <span class="type-count" id="legendTemplate">0</span>
                <span class="type-label">Templates</span>
              </div>
            </div>
          </div>

          <div class="analytics-section">
            <h4>Top FAQ Triggers</h4>
            <p class="section-helper">Keywords that triggered your auto-replies</p>
            <div class="faq-triggers-list" id="faqTriggersList">
              <div class="empty-state-inline">
                <span class="empty-icon">‚ùì</span>
                <p class="empty-triggers">No triggers yet</p>
                <p class="empty-hint">Set up FAQ rules in the Timer/FAQ tab to see which keywords are most popular!</p>
              </div>
            </div>
          </div>

          <div class="analytics-actions">
            <button class="btn btn-secondary" id="exportAnalyticsBtn">Download Report</button>
          </div>

          <!-- Chat Export Section -->
          <hr class="section-divider">
          <h4>Chat History Export</h4>
          <p class="section-helper">Download all chat messages from this session as a CSV file.</p>
          <div class="chat-export-stats">
            <span id="chatHistoryCount">0</span> messages captured
          </div>
          <div class="chat-export-actions">
            <button class="btn btn-primary" id="exportChatBtn">Export Chat (CSV)</button>
            <button class="btn btn-secondary" id="clearChatHistoryBtn">Clear History</button>
          </div>
        </div>
      </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <button class="btn btn-link" id="settingsBtn" title="Open extension settings" aria-label="Settings">Settings</button>
      <a href="https://github.com/JakeLiuMe/buzzchat/issues" target="_blank" rel="noopener" class="support-link">Report Issue</a>
      <span class="version">v1.3.0</span>
    </footer>
  </div>

  <!-- Settings Modal -->
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Settings</h2>
        <button class="modal-close" id="closeSettingsBtn" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- General Settings Section -->
        <details class="settings-section" open>
          <summary>General</summary>
          <div class="settings-section-content">
            <div class="form-group">
              <label class="toggle-label dark-mode-toggle">
                <span>Dark Mode</span>
                <input type="checkbox" id="darkModeToggle" aria-label="Enable dark mode" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="form-group">
              <label for="chatSelector">Chat Input Selector (Advanced)</label>
              <input type="text" id="chatSelector" placeholder="Auto-detect" aria-describedby="chatSelector-help" title="Custom CSS selector for chat input field">
              <small id="chatSelector-help" class="help-text">Leave blank for auto-detection</small>
            </div>
            <div class="form-group">
              <label class="toggle-label">
                <span>Sound Notifications</span>
                <input type="checkbox" id="soundNotifications" checked aria-label="Enable sound notifications" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="form-group">
              <label class="toggle-label">
                <span>Show Message Count</span>
                <input type="checkbox" id="showMessageCount" checked aria-label="Show message count" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="form-group watermark-setting">
              <label class="toggle-label">
                <span>Powered by BuzzChat</span>
                <input type="checkbox" id="watermarkToggle" aria-label="Add BuzzChat watermark to messages" role="switch" title="Adds '- BuzzChat' to the end of your messages">
                <span class="toggle-slider"></span>
              </label>
              <small id="watermark-help" class="help-text watermark-bonus">Add "- BuzzChat" to your messages to help spread the word</small>
            </div>
            <div class="form-group">
              <h4>Export / Import</h4>
              <div class="form-row">
                <button class="btn btn-secondary" id="exportSettingsBtn" title="Download all settings as JSON file">Export All</button>
                <button class="btn btn-secondary" id="importSettingsBtn" title="Restore settings from JSON file">Import</button>
              </div>
              <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
          </div>
        </details>

        <!-- Quick Reply Settings Section -->
        <details class="settings-section">
          <summary>Quick Reply Buttons</summary>
          <div class="settings-section-content">
            <p class="help-text">These buttons appear on the live stream page for fast messaging.</p>
          <div class="form-group">
            <label class="toggle-label">
              <span>Show Quick Reply Bar</span>
              <input type="checkbox" id="quickReplyToggle" checked aria-label="Enable quick reply buttons" role="switch">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="form-group">
            <label for="quickReplyPosition">Bar Position</label>
            <select id="quickReplyPosition" class="form-select">
              <option value="bottom-right">Bottom Right ‚ÜòÔ∏è</option>
              <option value="bottom-left">Bottom Left ‚ÜôÔ∏è</option>
              <option value="top-right">Top Right ‚ÜóÔ∏è</option>
              <option value="top-left">Top Left ‚ÜñÔ∏è</option>
            </select>
          </div>
            <div class="quick-reply-buttons-list" id="quickReplyButtonsList">
              <!-- Buttons rendered by JS -->
            </div>
            <button class="btn btn-secondary btn-sm" id="addQuickReplyBtn">+ Add Button</button>
          </div>
        </details>

        <!-- Hotkeys Section -->
        <details class="settings-section">
          <summary>Hotkeys</summary>
          <div class="settings-section-content">
            <p class="help-text">Use Ctrl+1 through Ctrl+9 to instantly send messages while on a live stream.</p>
            <div class="hotkey-list" id="hotkeyList">
              <!-- Hotkey slots rendered by JS -->
            </div>
          </div>
        </details>

        <!-- Alerts Section -->
        <details class="settings-section">
          <summary>Alerts</summary>
          <div class="settings-section-content">
            <h4>Keyword Mention Alerts</h4>
            <p class="help-text">Get notified when specific words appear in chat.</p>
          <div class="form-group">
            <label class="toggle-label">
              <span>Enable Keyword Alerts</span>
              <input type="checkbox" id="keywordAlertsToggle" aria-label="Enable keyword alerts" role="switch">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="form-group">
            <label for="keywordAlertsList">Keywords (comma-separated)</label>
            <input type="text" id="keywordAlertsList" placeholder="shipping, returns, discount">
            <small class="help-text">You'll be alerted when these words appear in chat</small>
          </div>
            <div class="form-group">
              <label class="toggle-label">
                <span>Sound Notification</span>
                <input type="checkbox" id="keywordAlertsSoundToggle" checked aria-label="Enable sound for keyword alerts" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <h4 style="margin-top: var(--space-lg);">Bid Alerts</h4>
            <p class="help-text">Get notified when viewers place bids (detects $XX, "bid $XX", etc.)</p>
            <div class="form-group">
              <label class="toggle-label">
                <span>Enable Bid Alerts</span>
                <input type="checkbox" id="bidAlertsToggle" aria-label="Enable bid alerts" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="form-group">
              <label for="bidAlertsMinAmount">Minimum Bid Amount ($)</label>
              <input type="number" id="bidAlertsMinAmount" value="0" min="0" max="10000" step="1">
              <small class="help-text">Only alert for bids at or above this amount</small>
            </div>
            <div class="form-group">
              <label class="toggle-label">
                <span>Sound Notification</span>
                <input type="checkbox" id="bidAlertsSoundToggle" checked aria-label="Enable sound for bid alerts" role="switch">
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
        </details>

        <!-- Quick Reply Button Template -->
        <template id="quickReplyTemplate">
          <div class="quick-reply-edit-item">
            <div class="quick-reply-edit-row">
              <input type="text" class="quick-reply-emoji-input" placeholder="üî•" maxlength="2" aria-label="Button emoji">
              <input type="text" class="quick-reply-text-input" placeholder="Message text" maxlength="100" aria-label="Button text">
              <button class="btn btn-danger btn-icon remove-quick-reply-btn" aria-label="Remove button">&times;</button>
            </div>
          </div>
        </template>

        <!-- Hotkey Slot Template -->
        <template id="hotkeySlotTemplate">
          <div class="hotkey-slot">
            <span class="hotkey-label">Ctrl+X</span>
            <input type="text" class="hotkey-message" placeholder="Enter message..." maxlength="200">
          </div>
        </template>

        <!-- API Access Section -->
        <details class="settings-section">
          <summary>API Access</summary>
          <div class="settings-section-content">
            <div class="api-section" id="apiSection" style="display: none;">
          <p class="api-description">Control BuzzChat externally via MCP server or REST API.</p>

          <!-- API Keys List -->
          <div class="api-keys-container" id="apiKeysContainer">
            <div class="api-keys-list" id="apiKeysList">
              <p class="empty-keys" id="emptyKeysMessage">No API keys yet. Create one to get started.</p>
            </div>
            <button class="btn btn-secondary btn-sm" id="createApiKeyBtn">
              + Create API Key
            </button>
          </div>

          <!-- API Key Created Modal (inline) -->
          <div class="api-key-created" id="apiKeyCreated" style="display: none;">
            <div class="api-key-alert">
              <strong>Save this key now!</strong>
              <p>This is the only time you'll see the full key.</p>
              <div class="api-key-display">
                <code id="newApiKeyValue"></code>
                <button class="btn btn-primary btn-sm" id="copyNewApiKeyBtn">Copy</button>
              </div>
              <button class="btn btn-secondary btn-sm" id="closeApiKeyCreatedBtn">Done</button>
            </div>
          </div>

          <!-- Connection Instructions -->
          <div class="api-instructions">
            <details>
              <summary>MCP Server Setup</summary>
              <div class="code-block">
                <p>Add to your MCP client config:</p>
                <pre>{
  "mcpServers": {
    "buzzchat": {
      "command": "npx",
      "args": ["buzzchat-mcp"],
      "env": {
        "BUZZCHAT_API_KEY": "your-api-key"
      }
    }
  }
}</pre>
              </div>
            </details>
            <details>
              <summary>REST API Examples</summary>
              <div class="code-block">
                <p>Get bot status:</p>
                <pre>curl http://localhost:3847/status \
  -H "Authorization: Bearer your-api-key"</pre>
                <p>Enable bot:</p>
                <pre>curl -X POST http://localhost:3847/bot/enable \
  -H "Authorization: Bearer your-api-key"</pre>
              </div>
              </details>
            </div>
          </div>

          <!-- API Access Locked (Free/Pro tier) -->
          <div class="api-locked" id="apiLocked">
            <div class="locked-badge">
              <span class="locked-icon">üîí</span>
              <span class="locked-text">Max Feature</span>
            </div>
            <p>API access lets you control BuzzChat from external tools, automation scripts, or MCP-compatible assistants.</p>
            <button class="btn btn-primary btn-sm" id="unlockApiBtn">Upgrade to Max</button>
          </div>
          </div>
        </details>

        <!-- Referral Section -->
        <details class="settings-section">
          <summary>Referrals</summary>
          <div class="settings-section-content">
          <p class="referral-description">Share BuzzChat with other live sellers. You both get +10 bonus messages when they join!</p>

          <div class="referral-link-container">
            <label for="referralLink">Your Referral Code</label>
            <div class="referral-input-row">
              <input type="text" id="referralCode" readonly class="referral-code-input">
              <button class="btn btn-primary btn-sm" id="copyReferralBtn">Copy</button>
            </div>
          </div>

          <div class="referral-stats">
            <div class="referral-stat">
              <span class="referral-stat-value" id="referralCount">0</span>
              <span class="referral-stat-label">Friends Joined</span>
            </div>
            <div class="referral-stat">
              <span class="referral-stat-value" id="referralBonus">0</span>
              <span class="referral-stat-label">Bonus Messages</span>
            </div>
          </div>

          <div class="referral-redeem">
            <label for="redeemCode">Have a referral code?</label>
            <div class="referral-input-row">
              <input type="text" id="redeemCode" placeholder="Enter code" class="redeem-code-input">
              <button class="btn btn-secondary btn-sm" id="redeemCodeBtn">Redeem</button>
            </div>
              <small class="help-text referral-redeemed" id="referralRedeemedMsg" style="display: none;">You've already redeemed a referral code</small>
            </div>
          </div>
        </details>
      </div>
    </div>
  </div>

  <!-- Upgrade Modal -->
  <div class="modal" id="upgradeModal">
    <div class="modal-content modal-content-wide">
      <div class="modal-header">
        <h2>Choose Your Plan</h2>
        <button class="modal-close" id="closeUpgradeBtn" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Trial Banner -->
        <div class="trial-banner" id="trialBanner">
          <div class="trial-text">
            <strong>Try Pro free for 7 days</strong>
            <span>No credit card required</span>
          </div>
          <button class="btn btn-success" id="startTrialBtn">Start Free Trial</button>
        </div>

        <!-- Billing Toggle -->
        <div class="billing-toggle" id="billingToggle">
          <span class="billing-option" data-billing="monthly">Monthly</span>
          <label class="billing-switch">
            <input type="checkbox" id="annualBillingToggle">
            <span class="billing-slider"></span>
          </label>
          <span class="billing-option" data-billing="annual">Annual <span class="save-badge">Save 35%</span></span>
        </div>

        <!-- 4-Tier Pricing Grid -->
        <div class="pricing-grid pricing-grid-4">
          <!-- FREE -->
          <div class="pricing-card current-plan" id="freePlanCard">
            <div class="tier-badge current">Current Plan</div>
            <h3>Free</h3>
            <div class="price">$0<span>/forever</span></div>
            <ul class="features-list">
              <li>ü§ñ <strong>50 AI responses/day</strong></li>
              <li>3 FAQ auto-reply rules</li>
              <li>Basic giveaway picker</li>
              <li>Welcome & timer messages</li>
              <li>7-day chat history</li>
              <li class="feature-limited">1 platform</li>
            </ul>
            <button class="btn btn-secondary btn-lg" disabled>Your Plan</button>
          </div>

          <!-- PRO - Most Popular -->
          <div class="pricing-card recommended">
            <div class="tier-badge popular">Most Popular</div>
            <h3>Pro</h3>
            <div class="price" id="proPrice">$4.99<span>/month</span></div>
            <div class="price-annual" id="proPriceAnnual" style="display: none;">$39<span>/year</span></div>
            <p class="price-note" id="proPriceNote" style="display: none;">$3.25/month billed annually</p>
            <ul class="features-list">
              <li>ü§ñ <strong>Unlimited AI responses</strong></li>
              <li>‚ö° <strong>Smart chat queue</strong></li>
              <li>üéØ <strong>Intent detection</strong></li>
              <li>Unlimited FAQ rules</li>
              <li>Animated giveaway wheel</li>
              <li>30-day analytics + export</li>
              <li>All platforms</li>
            </ul>
            <button class="btn btn-primary btn-lg" id="subscribePro">Start Free Trial</button>
          </div>

          <!-- SELLER+ - Best Value -->
          <div class="pricing-card featured">
            <div class="tier-badge value">Best Value</div>
            <h3>Seller+</h3>
            <div class="price" id="businessPrice">$12.99<span>/month</span></div>
            <div class="price-annual" id="businessPriceAnnual" style="display: none;">$99<span>/year</span></div>
            <p class="price-note" id="businessPriceNote" style="display: none;">$8.25/month billed annually</p>
            <ul class="features-list">
              <li>Everything in Pro, plus:</li>
              <li>üìä <strong>Live seller dashboard</strong></li>
              <li>üì¶ <strong>Inventory tracking</strong></li>
              <li>üõí <strong>SOLD auto-detection</strong></li>
              <li>üë§ <strong>Buyer profiles</strong></li>
              <li>Multi-account (5 configs)</li>
              <li>Team seats (3 members)</li>
              <li>90-day history</li>
            </ul>
            <button class="btn btn-primary btn-lg" id="subscribeBusiness">Start Free Trial</button>
          </div>

          <!-- TEAM -->
          <div class="pricing-card" id="teamPlanCard">
            <div class="tier-badge team">Teams</div>
            <h3>Team</h3>
            <div class="price" id="teamPrice">$29.99<span>/month</span></div>
            <div class="price-annual" id="teamPriceAnnual" style="display: none;">$249<span>/year</span></div>
            <p class="price-note" id="teamPriceNote" style="display: none;">$20.75/month billed annually</p>
            <ul class="features-list">
              <li>Everything in Seller+, plus:</li>
              <li>üë• <strong>Unlimited team seats</strong></li>
              <li>üîå <strong>API access</strong></li>
              <li>üé® <strong>Custom AI training</strong></li>
              <li>üè∑Ô∏è White-label option</li>
              <li>1-year history</li>
              <li>Dedicated support</li>
            </ul>
            <button class="btn btn-primary btn-lg" id="subscribeTeam">Contact Sales</button>
          </div>
        </div>

        <!-- Feature Comparison Table -->
        <details class="feature-comparison">
          <summary>Compare all features</summary>
          <table class="comparison-table">
            <thead>
              <tr>
                <th>Feature</th>
                <th>Free</th>
                <th>Pro</th>
                <th>Seller+</th>
                <th>Team</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>ü§ñ AI Responses</td>
                <td>50/day</td>
                <td>Unlimited</td>
                <td>Unlimited</td>
                <td>Unlimited</td>
              </tr>
              <tr>
                <td>‚ö° Smart Chat Queue</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>üéØ Intent Detection</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>üìä Live Dashboard</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>üì¶ Inventory Tracking</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>üõí SOLD Detection</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>üë§ Buyer Profiles</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>FAQ Rules</td>
                <td>3</td>
                <td>Unlimited</td>
                <td>Unlimited</td>
                <td>Unlimited</td>
              </tr>
              <tr>
                <td>Analytics History</td>
                <td>7 days</td>
                <td>30 days</td>
                <td>90 days</td>
                <td>1 year</td>
              </tr>
              <tr>
                <td>Team Seats</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td>3 members</td>
                <td>Unlimited</td>
              </tr>
              <tr>
                <td>Multi-Account</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td>5 configs</td>
                <td>Unlimited</td>
              </tr>
              <tr>
                <td>API Access</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td class="feature-no">-</td>
                <td class="feature-yes">Yes</td>
              </tr>
              <tr>
                <td>Support</td>
                <td>Community</td>
                <td>Email 48hr</td>
                <td>Priority 24hr</td>
                <td>Dedicated</td>
              </tr>
            </tbody>
          </table>
        </details>
      </div>
    </div>
  </div>

  <!-- Account Manager Modal (Max tier only) -->
  <div class="modal" id="accountManagerModal" role="dialog" aria-labelledby="account-manager-title" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="account-manager-title">Manage Setups</h2>
        <button class="modal-close" id="closeAccountManagerBtn" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <p class="modal-description">Create separate configurations for different shows, products, or streaming styles.</p>

        <div class="accounts-list" id="accountsList">
          <!-- Populated dynamically -->
        </div>

        <div class="account-actions">
          <button class="btn btn-primary" id="createAccountModalBtn">+ New Setup</button>
        </div>

        <!-- Create Account Form (inline) -->
        <div class="create-account-form" id="createAccountForm" style="display: none;">
          <div class="form-group">
            <label for="newAccountName">Setup Name</label>
            <input type="text" id="newAccountName" placeholder="e.g., Weekend Sales, Electronics Show">
          </div>
          <div class="form-row">
            <button class="btn btn-primary btn-sm" id="confirmCreateAccountBtn">Create</button>
            <button class="btn btn-secondary btn-sm" id="cancelCreateAccountBtn">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Onboarding/Disclaimer Modal - 3 Step Wizard -->
  <div class="modal" id="onboardingModal" role="dialog" aria-labelledby="onboarding-title" aria-modal="true">
    <div class="modal-content onboarding-modal">
      <div class="modal-header">
        <h2 id="onboarding-title">Welcome to BuzzChat</h2>
      </div>

      <!-- Step Indicator -->
      <div class="onboarding-steps">
        <div class="onboarding-step active" data-step="1">
          <span class="step-number">1</span>
          <span class="step-label">Welcome</span>
        </div>
        <div class="onboarding-step" data-step="2">
          <span class="step-number">2</span>
          <span class="step-label">Setup</span>
        </div>
        <div class="onboarding-step" data-step="3">
          <span class="step-number">3</span>
          <span class="step-label">First Message</span>
        </div>
      </div>

      <!-- Step 1: Welcome & Disclaimer -->
      <div class="onboarding-panel active" id="onboarding-step-1">
        <div class="onboarding-section">
          <h3>What This Extension Does</h3>
          <ul>
            <li>Automatically sends welcome messages to new viewers</li>
            <li>Sends timed promotional messages during your stream</li>
            <li>Auto-replies to frequently asked questions</li>
            <li>Saves you time so you can focus on selling</li>
          </ul>
        </div>

        <div class="onboarding-section disclaimer">
          <h3>Important Disclaimer</h3>
          <p>This extension automates chat messages on live selling platforms. By using this extension, you agree that:</p>
          <ul>
            <li>You will use it responsibly and in compliance with the platform's Terms of Service</li>
            <li>You are solely responsible for the messages sent by this bot</li>
            <li>We are not affiliated with any live selling platform</li>
            <li>Misuse may result in account restrictions (use at your own risk)</li>
          </ul>
        </div>

        <div class="onboarding-section privacy">
          <h3>Privacy & Data Collection</h3>
          <p>To improve our service, we collect:</p>
          <ul>
            <li>Anonymous usage analytics (message counts, feature usage)</li>
            <li>Your settings (stored locally in your browser)</li>
            <li>Payment information for Pro/Max (via ExtensionPay)</li>
          </ul>
          <p style="margin-top: 8px; font-size: 12px;">
            <a href="https://buzzchat.app/privacy" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Read our full Privacy Policy</a>
          </p>
        </div>

        <label class="checkbox-accept">
          <input type="checkbox" id="acceptTerms">
          <span>I accept the terms of use and <a href="https://buzzchat.app/privacy" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">Privacy Policy</a></span>
        </label>
      </div>

      <!-- Step 2: Quick Setup -->
      <div class="onboarding-panel" id="onboarding-step-2">
        <div class="onboarding-section">
          <h3>Choose Your Features</h3>
          <p style="font-size: 13px; color: var(--gray-600); margin-bottom: 16px;">Select which features you want to enable. You can change these later.</p>
        </div>

        <div class="setup-options">
          <label class="setup-option">
            <input type="checkbox" id="setupWelcome" checked>
            <div class="setup-option-content">
              <h4>Welcome Messages</h4>
              <p>Automatically greet new viewers when they join</p>
            </div>
          </label>

          <label class="setup-option">
            <input type="checkbox" id="setupTimer">
            <div class="setup-option-content">
              <h4>Timer Messages</h4>
              <p>Send recurring promotional messages on a schedule</p>
            </div>
          </label>

          <label class="setup-option">
            <input type="checkbox" id="setupFaq">
            <div class="setup-option-content">
              <h4>FAQ Auto-Reply</h4>
              <p>Automatically answer common questions like "shipping?"</p>
            </div>
          </label>
        </div>
      </div>

      <!-- Step 3: First Message -->
      <div class="onboarding-panel" id="onboarding-step-3">
        <div class="onboarding-section">
          <h3>Create Your Welcome Message</h3>
          <p style="font-size: 13px; color: var(--gray-600); margin-bottom: 16px;">This message will be sent when new viewers join your stream.</p>
        </div>

        <div class="form-group">
          <label for="onboardingMessage">Welcome Message</label>
          <textarea id="onboardingMessage" rows="3" placeholder="Hey {username}! Welcome to the stream! üéâ">Hey {username}! Welcome to the stream! Drop a comment to enter our giveaway!</textarea>
          <small class="help-text">Use {username} to include the viewer's name</small>
        </div>

        <div class="message-preview">
          <div class="message-preview-label">Preview</div>
          <div class="message-bubble" id="messagePreview">Hey StreamViewer! Welcome to the stream! Drop a comment to enter our giveaway!</div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="onboarding-nav">
        <button class="btn btn-secondary" id="onboardingPrevBtn" style="visibility: hidden;">Back</button>
        <button class="btn btn-primary" id="onboardingNextBtn" disabled>Next</button>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal" id="helpModal" role="dialog" aria-labelledby="help-modal-title" aria-modal="true">
    <div class="modal-content help-modal">
      <div class="modal-header">
        <h2 id="help-modal-title">Help & Support</h2>
        <button class="modal-close" id="closeHelpBtn" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="help-section">
          <h3>Quick Help</h3>
          <div class="help-faq">
            <details>
              <summary>How do I enable the bot?</summary>
              <p>Toggle the "Bot Active" switch at the top of the extension. Make sure you're on a supported live selling page.</p>
            </details>
            <details>
              <summary>Why aren't my messages sending?</summary>
              <p>Check that you're on a live stream page, the bot is enabled, and your message limits haven't been reached.</p>
            </details>
            <details>
              <summary>How do FAQ auto-replies work?</summary>
              <p>Add trigger keywords (like "shipping") and a response. When someone types a message containing that keyword, the bot will reply automatically.</p>
            </details>
          </div>
        </div>

        <div class="help-section">
          <h3>Get Support</h3>
          <div class="help-links">
            <a href="https://github.com/JakeLiuMe/buzzchat/issues/new?template=bug_report.md" target="_blank" rel="noopener" class="help-link">
              <span class="help-link-icon">üêõ</span>
              <span class="help-link-text">
                <strong>Report a Bug</strong>
                <small>Found something broken? Let us know</small>
              </span>
            </a>
            <a href="https://github.com/JakeLiuMe/buzzchat/issues/new?template=feature_request.md" target="_blank" rel="noopener" class="help-link">
              <span class="help-link-icon">üí°</span>
              <span class="help-link-text">
                <strong>Request a Feature</strong>
                <small>Have an idea? We'd love to hear it</small>
              </span>
            </a>
            <a href="https://github.com/JakeLiuMe/buzzchat#troubleshooting" target="_blank" rel="noopener" class="help-link">
              <span class="help-link-icon">üìñ</span>
              <span class="help-link-text">
                <strong>Troubleshooting Guide</strong>
                <small>Common issues and solutions</small>
              </span>
            </a>
            <a href="https://github.com/JakeLiuMe/buzzchat" target="_blank" rel="noopener" class="help-link">
              <span class="help-link-icon">üìö</span>
              <span class="help-link-text">
                <strong>Documentation</strong>
                <small>Full guide and setup instructions</small>
              </span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Bar (Always visible at bottom) -->
  <div class="quick-actions" id="quickActionsBar">
    <button id="quickToggle" class="quick-btn primary" title="Turn bot on/off">
      <span class="quick-icon">&#x26A1;</span>
      <span class="quick-label">Go Live</span>
    </button>
    <button id="quickTemplate" class="quick-btn" title="Send quick message">
      <span class="quick-icon">&#x1F4AC;</span>
      <span class="quick-label">Send</span>
    </button>
    <button id="quickGiveaway" class="quick-btn" title="Start/manage giveaway">
      <span class="quick-icon">&#x1F381;</span>
      <span class="quick-label">Giveaway</span>
    </button>
  </div>

  <!-- Onboarding Overlay (First-time users) -->
  <div class="onboarding-overlay" id="onboardingOverlay" style="display: none;" role="dialog" aria-modal="true">
    <div class="onboarding-backdrop"></div>
    <div class="onboarding-tooltip" id="onboardingTooltip">
      <div class="onboarding-content">
        <h3 id="onboardingTitle">Welcome to BuzzChat!</h3>
        <p id="onboardingMessage">Automate your live selling chat in seconds.</p>
      </div>
      <div class="onboarding-actions">
        <span class="onboarding-progress" id="onboardingProgress">1 / 5</span>
        <button class="onboarding-btn skip" id="onboardingSkip">Skip</button>
        <button class="onboarding-btn primary" id="onboardingNext">Next</button>
      </div>
    </div>
  </div>

  <!-- Spinning Wheel Overlay -->
  <div class="wheel-overlay" id="wheelOverlay" role="dialog" aria-labelledby="wheelStatus" aria-modal="true">
    <div class="wheel-container">
      <div class="wheel-pointer"></div>
      <div class="wheel" id="spinningWheel" role="img" aria-label="Spinning giveaway wheel">
        <!-- Wheel segments generated by JS -->
      </div>
      <div class="wheel-center">
        <span>SPIN</span>
      </div>
    </div>
    <div class="wheel-status" id="wheelStatus" aria-live="polite">Spinning...</div>
  </div>

  <!-- Confetti Canvas -->
  <canvas id="confettiCanvas"></canvas>

  <!-- Confirmation Dialog Modal -->
  <div class="modal" id="confirmModal" role="alertdialog" aria-labelledby="confirm-title" aria-describedby="confirm-message" aria-modal="true">
    <div class="modal-content confirm-modal">
      <div class="modal-header confirm-header">
        <h2 id="confirm-title">Confirm Action</h2>
      </div>
      <div class="modal-body confirm-body">
        <p id="confirm-message">Are you sure you want to proceed?</p>
      </div>
      <div class="modal-footer confirm-footer">
        <button class="btn btn-secondary" id="confirmCancelBtn">Cancel</button>
        <button class="btn btn-danger" id="confirmOkBtn">Delete</button>
      </div>
    </div>
  </div>

  <!-- Buyer Details Modal -->
  <div class="modal" id="buyerDetailsModal" role="dialog" aria-labelledby="buyer-detail-title" aria-modal="true">
    <div class="modal-content buyer-details-modal">
      <div class="modal-header">
        <h2 id="buyer-detail-title" class="buyer-detail-name">Buyer Details</h2>
        <button class="modal-close" id="closeBuyerDetailsBtn" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Buyer Stats -->
        <div class="buyer-detail-stats"></div>

        <!-- Buyer Tags -->
        <div class="buyer-tags-section">
          <h4>Tags</h4>
          <div class="buyer-detail-tags"></div>
        </div>

        <!-- Purchase History -->
        <div class="buyer-history-section">
          <h4>Recent Purchases</h4>
          <div class="buyer-purchase-history"></div>
        </div>

        <!-- Notes -->
        <div class="buyer-notes-section">
          <h4>Notes</h4>
          <textarea class="buyer-detail-notes" id="buyerNotesInput" rows="3" placeholder="Add notes about this buyer..." maxlength="500"></textarea>
          <button class="btn btn-primary btn-sm" id="saveBuyerNotesBtn">Save Notes</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Buyer Search Modal -->
  <div class="modal" id="buyerSearchModal" role="dialog" aria-labelledby="buyer-search-title" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="buyer-search-title">Search Buyers</h2>
        <button class="modal-close" id="closeBuyerSearchBtn" aria-label="Close modal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <input type="text" id="buyerSearchInput" placeholder="Search by username..." autofocus>
        </div>
        <div class="buyer-search-results" id="buyerSearchResults">
          <p class="help-text">Enter a username to search</p>
        </div>
      </div>
    </div>
  </div>

  <script src="popup.js" type="module"></script>
</body>
</html>
