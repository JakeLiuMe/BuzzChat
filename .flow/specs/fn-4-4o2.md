# Chrome Extension UX Polish: Academic Design Principles Audit

## Overview

Audit the BuzzChat Chrome extension against 6 academic UX design principles and implement targeted improvements.

## Current Grade: B- (82/100)

### Grading Rubric

| Principle | Weight | Score |
|-----------|--------|-------|
| Simplicity & Minimalism | 20 pts | 14/20 |
| Clarity & Visual Hierarchy | 20 pts | 16/20 |
| Consistency & Cohesion | 15 pts | 11/15 |
| Gestalt Principles | 15 pts | 13/15 |
| Proportion & Alignment | 15 pts | 14/15 |
| User Control & Feedback | 15 pts | 14/15 |

**Target Grade: A- (90/100)**

## Component Inventory

### Entry Stylesheet

`popup.html` links `popup.css`. All CSS work happens in `popup.css`.

Note: `src/popup/styles/components/buttons.css` has `.btn-primary:active` (line 32) but is NOT loaded - popup.css is the active stylesheet.

### Token Inventory (Verified in popup.css :root)

**Existing**: `--primary`, `--primary-hover`, `--success`, `--danger`, `--warning`, `--gray-*`, `--bg-*`, `--text-*`

**To Add**:
- `--primary-active: #5b21b6`
- `--danger-hover: #dc2626`
- `--danger-active: #b91c1c`
- `--success-hover: #059669`
- `--success-active: #047857`

### Key Code Locations

| Component | File | Line(s) |
|-----------|------|---------|
| Add functions | `src/popup/popup.js` | 2421, 2516, 2595, 2679 |
| Loading helper | `src/popup/popup.js` | (search `Loading.show`) |
| Giveaway counter (HTML) | `src/popup/popup.html` | 411 (`id="giveawayEntryCount"`) |
| Giveaway counter (live update) | `src/popup/popup.js` | ~2342 (uses `message.totalEntries`) |
| Giveaway counter (load) | `src/popup/popup.js` | ~4350 (uses `response.totalEntries`) |
| Member since logic | `src/popup/popup.js` | 1681-1705 |
| Generic `.btn:active` | `src/popup/popup.css` | line 1355 |
| `.tabs` container | `src/popup/popup.css` | line 432 (`display: flex`) |
| `.tab-btn` | `src/popup/popup.css` | line 455 (`flex: 1`) |
| `.header-left` / `.header-right` | `src/popup/popup.css` | lines 166, 236 |

## Scope

**In Scope**: `popup.html`, `popup.css`, `popup.js` - both themes

**Out of Scope**: Content script, new features, backend

## Approach

### Phase 1: Token Addition

1. Add to `:root` in popup.css:
   ```css
   --primary-active: #5b21b6;
   --danger-hover: #dc2626;
   --danger-active: #b91c1c;
   --success-hover: #059669;
   --success-active: #047857;
   ```

2. Add `.btn-primary:active`, `.btn-danger:active`, `.btn-success:active` rules to popup.css **immediately after line 1357** (after the `.btn:active { transform: scale(0.97); }` block):
   ```css
   /* Variant-specific active states - placed after .btn:active for proper specificity */
   .btn-primary:active:not(:disabled) {
     background: var(--primary-active);
     transform: scale(0.98);
   }
   .btn-danger:active:not(:disabled) {
     background: var(--danger-active);
     transform: scale(0.98);
   }
   .btn-success:active:not(:disabled) {
     background: var(--success-active);
     transform: scale(0.98);
   }
   ```

3. Update `.btn-danger:hover`, `.btn-success:hover` to use variables.

### Phase 2: Visual Hierarchy

**Tab Font + Truncation**:
- Target: `.tab-btn span` in popup.css
- Note: `.tabs` already has `display: flex` (line 432) and `.tab-btn` already has `flex: 1` (line 455), ensuring equal-width tabs
- Add truncation rule for the span:
  ```css
  .tab-btn span {
    font-size: 12px;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  ```
- Labels: "Cmds" → "Commands", "Mod" → "Moderation"

**Tier Banner**:
- Hide `.member-since` element via CSS: `.member-since { display: none !important; }`
- In popup.js `updateTierBanner()`:
  - **Keep** the initialization + saveSettings block that sets `settings.memberSince` for new Pro users (lines ~1685-1690)
  - **Remove only** the lines that set `memberSinceEl.textContent` and `memberSinceEl.style.display = 'inline'`
  - Add tooltip after the initialization block: `tierLabel.title = settings.memberSince ? "Member since " + new Date(settings.memberSince).toLocaleDateString() : "";`

**Secondary Button (.btn-ghost)**: Add to popup.css using theme tokens.

**Header Element Grouping** (addresses Gestalt principles gap):
- Header already uses `.header-left` and `.header-right` containers with `display: flex; gap: var(--space-md)` (lines 166, 236)
- No DOM changes needed; existing structure is acceptable
- Minor enhancement: reduce gap in `.header-right` from `--space-md` to `--space-sm` for tighter grouping of action buttons
- This is a CSS-only change, no selector breakage risk

### Phase 3: Simplicity

**Settings Modal**: `<details class="settings-section">` with first `open`

**Giveaway Tab**: 4 visual groups with spacing

### Phase 4: Micro-interactions

**Add Button Loading States**:

Functions to modify in `popup.js`:
- `addTimerMessage()` at line 2421
- `addFaqRule()` at line 2516
- `addTemplate()` at line 2595
- `addCommand()` at line 2679

Refactoring approach (single try/finally in handler only):
1. Make add function async
2. Add `await` before `saveSettings()` in the function
3. **No try/finally in add function** - just return the promise
4. Event handler has the single try/finally:
   ```js
   elements.addTimerBtn.addEventListener('click', async () => {
     Loading.show(elements.addTimerBtn);
     try { await addTimerMessage(); }
     finally { Loading.hide(elements.addTimerBtn); }
   });
   ```

**Giveaway Counter Animation**:

All updates in `popup.js` (single file). Add at top of file with defensive null check:
```js
let previousGiveawayEntryCount = 0;
function updateGiveawayEntryCount(count, animate = false) {
  const counter = document.getElementById('giveawayEntryCount');
  if (!counter) return; // Guard for missing element
  if (animate && count > previousGiveawayEntryCount && previousGiveawayEntryCount > 0) {
    if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      counter.classList.add('pulse-animation');
      setTimeout(() => counter.classList.remove('pulse-animation'), 200);
    }
  }
  counter.textContent = count;
  previousGiveawayEntryCount = count;
}
```

Call sites to update in popup.js:
1. **Live message handler (~line 2342)**: Replace direct textContent update with `updateGiveawayEntryCount(Math.max(0, Math.floor(message.totalEntries)), true)` to animate on increment
2. **loadGiveawayData (~line 4350)**: Replace direct textContent update with `updateGiveawayEntryCount(response.totalEntries || 0, false)` for initial load (no animation)

CSS in popup.css:
```css
.pulse-animation {
  animation: pulse 0.2s ease;
}
@keyframes pulse {
  50% { transform: scale(1.05); }
}
@media (prefers-reduced-motion: reduce) {
  .pulse-animation { animation: none; }
}
```

**Spin Wheel Loading**:

Add to popup.css:
```css
#spinWheelBtn.loading {
  color: inherit;
  opacity: 0.6;
  pointer-events: none;
}
#spinWheelBtn.loading::after { display: none; }
```

In Loading helper (popup.js), add `aria-disabled`:
- In `Loading.show()`: add `element.setAttribute('aria-disabled', 'true');`
- In `Loading.hide()`: add `element.removeAttribute('aria-disabled');`

## Acceptance Criteria

- [ ] 5 new tokens added to :root
- [ ] `.btn-primary:active`, `.btn-danger:active`, `.btn-success:active` added immediately after line 1357 in popup.css
- [ ] Tab labels 12px with max-width truncation (existing flex layout confirmed)
- [ ] `.member-since` hidden via CSS, tooltip on tierLabel
- [ ] popup.js: memberSince initialization + saveSettings preserved, only display lines removed, tooltip added
- [ ] `.header-right` gap reduced to `--space-sm` (CSS-only, no DOM change)
- [ ] Add functions in popup.js made async, single try/finally in event handler only
- [ ] `updateGiveawayEntryCount()` function with null guard added to popup.js
- [ ] Counter call sites: live handler uses `Math.max(0, Math.floor(message.totalEntries))`, load uses `response.totalEntries || 0`
- [ ] Spin wheel loading keeps label visible

## QA Checklist

| Test | Light | Dark |
|------|-------|------|
| 320px tabs fit | ☐ | ☐ |
| Tier tooltip shows date | ☐ | ☐ |
| Add button loading | ☐ | ☐ |
| Counter animates on new entry | ☐ | ☐ |
| Spin wheel label visible during spin | ☐ | ☐ |

## References

- `popup.css:1-95` - :root
- `popup.css:1355-1357` - `.btn:active` placement point
- `popup.css:432` - `.tabs` container
- `popup.css:455` - `.tab-btn` with `flex: 1`
- `popup.css:166, 236` - `.header-left`, `.header-right`
- `popup.js:1681-1705` - member since logic
- `popup.js:2421, 2516, 2595, 2679` - add functions
- `popup.js:~2342` - live giveaway counter update
- `popup.js:~4350` - loadGiveawayData counter update
- `popup.html:411` - giveawayEntryCount element
